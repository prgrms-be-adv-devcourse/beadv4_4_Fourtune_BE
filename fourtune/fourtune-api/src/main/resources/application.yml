spring:
  application:
    name: fourtune
  jackson:
    time-zone: Asia/Seoul # 한국 시간으로 변환
    locale: ko_KR

  profiles:
    active: local

  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true

  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 50MB

  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${OAUTH_CLIENT_ID}
            client-secret: ${OAUTH_CLIENT_SECRET}
            redirect-uri: ${OAUTH_BACKEND_URI}/login/oauth2/code/google
            scope:
              - profile
              - email
app:
  oauth2:
    redirect-uri: ${OAUTH_FRONTEND_URI}/login-success
  view-count:
    use-redis: ${VIEW_COUNT_USE_REDIS:true}
    key-prefix: "auction:view:"
    sync-interval-ms: 60000  # 1분마다 Redis → DB 동기화

# SpringDoc OpenAPI (Swagger) 설정
springdoc:
  api-docs:
    path: /v3/api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: method
    tags-sorter: alpha
    try-it-out-enabled: true
  paths-to-exclude:
    - /actuator/**
    - /error

# Actuator & Prometheus 설정
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}

logging:
  level:
    root: INFO
    com.fourtune: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

# Feature Flags (이벤트 발행 방식 전환)
feature:
  kafka:
    enabled: false
    user-events:
      enabled: false
    auction-events:
      enabled: false

# Outbox 설정
outbox:
  publisher:
    batch-size: 100
    max-retry-count: 3
    poll-interval-ms: 1000

# application.yml
settlement:
  scheduler:
    collect-cron: ${SETTLEMENT_SCHEDULER_COLLECT_CRON:0 */5 * * * *} # (시연용) 5분 마다
    complete-cron: ${SETTLEMENT_SCHEDULER_COMPLETE_CRON:0 */5 * * * *} # (시연용) 5분 마다
    # cron: "0 0 0/1 * * *" # 예: 1시간마다 실행 (운영용)
  policy:
    waiting-days: ${SETTLEMENT_POLICY_WAITING_DAYS:0} # 구매 확정 후 정산 대기 일수 (0일이면 즉시 정산)

---
# Local Profile
spring:
  config:
    activate:
      on-profile: local

  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/fourtune_db}
    username: ${DB_USERNAME:fourtune_user}
    password: ${DB_PASSWORD:fourtune}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}

  elasticsearch:
    uris: ${ELASTICSEARCH_URIS:http://localhost:9200}

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:19092}
    consumer:
      group-id: fourtune-consumer-group
      auto-offset-reset: earliest
    producer:
      acks: all

  cloud:
    aws:
      credentials:
        access-key: ${AWS_ACCESS_KEY}
        secret-key: ${AWS_SECRET_KEY}
      region:
        static: ${AWS_REGION:ap-northeast-2}
      s3:
        bucket: ${AWS_S3_BUCKET}
        path-prefix: "local/${S3_USER_ID}"

feature:
  kafka:
    enabled: true
    user-events:
      enabled: true
    auction-events:
      enabled: true
    watchlist-events:
      enabled: true
    notification-events:
      enabled: true


# JWT 설정
jwt:
  secret: ${JWT_SECRET}

  access-token-expiration: 1800000 # 30분
  refresh-token-expiration: 1209600000 # 2주

# 암호화 키 (AES-256)
encryption:
  key: your-local-encryption-key-32-chars # 32자 (256비트)

# 경매 설정
auction:
  bid-unit: 1000 # 입찰 단위 (원)
  auto-extend-minutes: 3 # 자동 연장 시간
  auto-extend-threshold-minutes: 5 # 연장 발동 시간
  payment-deadline-days: 1 # 결제 기한 (낙찰 기준)
  seller-shipping-deadline-days: 7 # 발송 기한
  settlement-fee-rate: 0.1 # 정산 수수료 (10%)

# 주문/결제 대기 설정 (ORDER_PAYMENT_POLICY: 즉시구매 10분 / 낙찰 24시간)
order:
  buy-now-pending-timeout-minutes: ${ORDER_BUYNOW_PENDING_TIMEOUT_MINUTES:10} # 즉시구매 결제 유예 (분)
  bid-pending-timeout-hours: ${ORDER_BID_PENDING_TIMEOUT_HOURS:24} # 낙찰 결제 유예 (시간)

payment:
  toss:
    client-key: ${TOSS_CLIENT_KEY}
    secret-key: ${TOSS_SECRET_KEY}

# 검색 설정
search:
  page-size: 20 # 검색 결과 페이지 크기
  max-from: 10000 # Deep paging 최대 from 값
  max-keyword-length: 100 # 검색 키워드 최대 길이

# 결제 모듈에서 주문 데이터 조회
api:
  auction:
    base-url: http://localhost:8080

---
# Test Profile (CI/CD용)
spring:
  config:
    activate:
      on-profile: test

  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/fourtune_test_db}
    username: ${DB_USERNAME:test_user}
    password: ${DB_PASSWORD:test_password}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 5

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}

  elasticsearch:
    uris: ${ELASTICSEARCH_URIS:http://localhost:9200}

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    consumer:
      group-id: fourtune-test-consumer-group
      auto-offset-reset: earliest
  cloud:
    aws:
      credentials:
        access-key: ${AWS_ACCESS_KEY:test}
        secret-key: ${AWS_SECRET_KEY:test}
      region:
        static: ${AWS_REGION:ap-northeast-2}
      s3:
        bucket: ${AWS_S3_BUCKET:test-bucket}
        path-prefix: "test"

feature:
  kafka:
    enabled: true
    user-events:
      enabled: true
    auction-events:
      enabled: true
    watchlist-events:
      enabled: true
    notification-events:
      enabled: true

# Test에서는 Swagger 비활성화
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false

logging:
  level:
    root: WARN
    com.fourtune: INFO

# 주문/결제 대기 설정 (ORDER_PAYMENT_POLICY)
order:
  buy-now-pending-timeout-minutes: ${ORDER_BUYNOW_PENDING_TIMEOUT_MINUTES:10}
  bid-pending-timeout-hours: ${ORDER_BID_PENDING_TIMEOUT_HOURS:24}

# 결제 모듈에서 주문 데이터 조회
api:
  auction:
    base-url: http://localhost:8080

---
# Development Profile
spring:
  config:
    activate:
      on-profile: dev

  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false

  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      password: ${REDIS_PASSWORD}

  elasticsearch:
    uris: ${ELASTICSEARCH_URIS}

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
    consumer:
      group-id: fourtune-consumer-group
      auto-offset-reset: earliest
    producer:
      acks: all

  cloud:
    aws:
      credentials:
        access-key: ${AWS_ACCESS_KEY}
        secret-key: ${AWS_SECRET_KEY}
      region:
        static: ${AWS_REGION:ap-northeast-2}
      s3:
        bucket: ${AWS_S3_BUCKET}
        path-prefix: "dev"

feature:
  kafka:
    enabled: true
    user-events:
      enabled: true
    auction-events:
      enabled: true
    watchlist-events:
      enabled: true
    notification-events:
      enabled: true

jwt:
  secret: ${JWT_SECRET}
  access-token-expiration: 3600000
  refresh-token-expiration: 1209600000

encryption:
  key: ${ENCRYPTION_KEY}

auction:
  bid-unit: 1000
  auto-extend-minutes: 3
  auto-extend-threshold-minutes: 5
  payment-deadline-days: 1
  seller-shipping-deadline-days: 7
  settlement-fee-rate: 0.1

order:
  buy-now-pending-timeout-minutes: ${ORDER_BUYNOW_PENDING_TIMEOUT_MINUTES:10}
  bid-pending-timeout-hours: ${ORDER_BID_PENDING_TIMEOUT_HOURS:24}

payment:
  toss:
    client-key: ${TOSS_CLIENT_KEY}
    secret-key: ${TOSS_SECRET_KEY}

# 검색 설정
search:
  page-size: 20
  max-from: 10000
  max-keyword-length: 100

logging:
  level:
    root: INFO
    com.fourtune: DEBUG

# 결제 모듈에서 주문 데이터 조회
api:
  auction:
    base-url: http://localhost:8080

---
# Production Profile
spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 30
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false

  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      password: ${REDIS_PASSWORD}

  elasticsearch:
    uris: ${ELASTICSEARCH_URIS}

  #  kafka:
  #    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
  #    consumer:
  #      group-id: fourtune-consumer-group
  #      auto-offset-reset: earliest
  #    producer:
  #      acks: all
  #      retries: 3

  cloud:
    aws:
      credentials:
        access-key: ${AWS_ACCESS_KEY}
        secret-key: ${AWS_SECRET_KEY}
      region:
        static: ${AWS_REGION:ap-northeast-2}
      s3:
        bucket: ${AWS_S3_BUCKET}
        path-prefix: "prod"

feature:
  kafka:
    enabled: false

jwt:
  secret: ${JWT_SECRET}
  access-token-expiration: 3600000
  refresh-token-expiration: 1209600000

encryption:
  key: ${ENCRYPTION_KEY}

auction:
  bid-unit: 1000
  auto-extend-minutes: 3
  auto-extend-threshold-minutes: 5
  payment-deadline-days: 1
  seller-shipping-deadline-days: 7
  settlement-fee-rate: 0.1

order:
  buy-now-pending-timeout-minutes: ${ORDER_BUYNOW_PENDING_TIMEOUT_MINUTES:10}
  bid-pending-timeout-hours: ${ORDER_BID_PENDING_TIMEOUT_HOURS:24}

payment:
  toss:
    client-key: ${TOSS_CLIENT_KEY}
    secret-key: ${TOSS_SECRET_KEY}

search:
  page-size: 20
  max-from: 10000
  max-keyword-length: 100

# Production에서는 Swagger 비활성화 (보안)
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false

logging:
  level:
    root: WARN
    com.fourtune: INFO

# 결제 모듈에서 주문 데이터 조회
api:
  auction:
    base-url: http://localhost:8080

custom:
  services:
    payout_url: http://payment-service:8081
    cash_url: http://payment-service:8081
