spring:
  application:
    name: fourtune

  batch:
    job:
      enabled: false
      
  config:
    import: classpath:application-common.yml

  jackson:
    time-zone: Asia/Seoul # 한국 시간으로 변환
    locale: ko_KR

  profiles:
    active: local

  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true

  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 50MB

  # security.oauth2 설정들은 application-common.yml에 중앙화 되어있음
security:
  oauth:
    enabled: true

app:
  oauth2:
    redirect-uri: ${OAUTH_FRONTEND_URI}/login-success

# SpringDoc OpenAPI (Swagger) 설정
springdoc:
  api-docs:
    path: /v3/api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: method
    tags-sorter: alpha
    try-it-out-enabled: true
    urls:
      - name: fourtune-api
        url: /v3/api-docs
      - name: auction-service
        url: /v3/api-docs/auction
      - name: payment-service
        url: /v3/api-docs/payment
      - name: recommendation-service
        url: /v3/api-docs/recommendation
  paths-to-exclude:
    - /actuator/**
    - /error
    - /api/internal/**

# Actuator & Prometheus 설정
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    tags:
      application: ${spring.application.name}
  prometheus:
    metrics:
      export:
        enabled: true

logging:
  level:
    root: INFO
    com.fourtune: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

# Feature Flags (이벤트 발행 방식 전환)
feature:
  kafka:
    enabled: false
    user-events:
      enabled: false
    auction-events:
      enabled: false

# Outbox 설정
outbox:
  publisher:
    batch-size: 100
    max-retry-count: 3
    poll-interval-ms: 1000

---
# Local Profile
spring:
  config:
    activate:
      on-profile: local

  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/fourtune_db}
    username: ${DB_USERNAME:fourtune_user}
    password: ${DB_PASSWORD:fourtune}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}

  elasticsearch:
    uris: ${ELASTICSEARCH_URIS:http://localhost:9200}

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:19092}
    consumer:
      group-id: fourtune-consumer-group
      auto-offset-reset: earliest
    producer:
      acks: all

  cloud:
    aws:
      credentials:
        access-key: ${AWS_ACCESS_KEY}
        secret-key: ${AWS_SECRET_KEY}
      region:
        static: ${AWS_REGION:ap-northeast-2}
      s3:
        bucket: ${AWS_S3_BUCKET}
        path-prefix: "local/${S3_USER_ID}"

feature:
  kafka:
    enabled: true
    user-events:
      enabled: true
    auction-events:
      enabled: true
    watchlist-events:
      enabled: true
    notification-events:
      enabled: true


# JWT 설정
jwt:
  secret: ${JWT_SECRET}

  access-token-expiration: 1800000 # 30분
  refresh-token-expiration: 1209600000 # 2주

# 암호화 키 (AES-256)
encryption:
  key: your-local-encryption-key-32-chars # 32자 (256비트)

api:
  auction:
    base-url: "http://localhost:8083"

---
# Test Profile (CI/CD용)
spring:
  config:
    activate:
      on-profile: test

  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/fourtune_test_db}
    username: ${DB_USERNAME:test_user}
    password: ${DB_PASSWORD:test_password}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 5

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}

  elasticsearch:
    uris: ${ELASTICSEARCH_URIS:http://localhost:9200}

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    consumer:
      group-id: fourtune-test-consumer-group
      auto-offset-reset: earliest
  cloud:
    aws:
      credentials:
        access-key: ${AWS_ACCESS_KEY:test}
        secret-key: ${AWS_SECRET_KEY:test}
      region:
        static: ${AWS_REGION:ap-northeast-2}
      s3:
        bucket: ${AWS_S3_BUCKET:test-bucket}
        path-prefix: "test"

feature:
  kafka:
    enabled: true
    user-events:
      enabled: true
    auction-events:
      enabled: true
    watchlist-events:
      enabled: true
    notification-events:
      enabled: true

# Test에서는 Swagger 비활성화
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false

logging:
  level:
    root: WARN
    com.fourtune: INFO

---
# Development Profile
server:
  forward-headers-strategy: native

spring:
  config:
    activate:
      on-profile: dev

  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false

  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      password: ${REDIS_PASSWORD}

  elasticsearch:
    uris: ${ELASTICSEARCH_URIS}

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
    consumer:
      group-id: fourtune-consumer-group
      auto-offset-reset: earliest
    producer:
      acks: all

  cloud:
    aws:
      credentials:
        access-key: ${AWS_ACCESS_KEY}
        secret-key: ${AWS_SECRET_KEY}
      region:
        static: ${AWS_REGION:ap-northeast-2}
      s3:
        bucket: ${AWS_S3_BUCKET}
        path-prefix: "dev"

feature:
  kafka:
    enabled: true
    user-events:
      enabled: true
    auction-events:
      enabled: true
    watchlist-events:
      enabled: true
    notification-events:
      enabled: true

jwt:
  secret: ${JWT_SECRET}
  access-token-expiration: 3600000
  refresh-token-expiration: 1209600000

encryption:
  key: ${ENCRYPTION_KEY}

api:
  auction:
    base-url: ${API_AUCTION_BASE_URL:http://localhost:8083}

logging:
  level:
    root: INFO
    com.fourtune: DEBUG

---
# Production Profile
server:
  forward-headers-strategy: native

spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 30
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false

  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      password: ${REDIS_PASSWORD}

  elasticsearch:
    uris: ${ELASTICSEARCH_URIS}

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
    consumer:
      group-id: fourtune-consumer-group
      auto-offset-reset: earliest
    producer:
      acks: all
      retries: 3

  cloud:
    aws:
      credentials:
        access-key: ${AWS_ACCESS_KEY}
        secret-key: ${AWS_SECRET_KEY}
      region:
        static: ${AWS_REGION:ap-northeast-2}
      s3:
        bucket: ${AWS_S3_BUCKET}
        path-prefix: "prod"

feature:
  kafka:
    enabled: true
    user-events:
      enabled: true
    auction-events:
      enabled: true
    watchlist-events:
      enabled: true
    notification-events:
      enabled: true

jwt:
  secret: ${JWT_SECRET}
  access-token-expiration: 3600000
  refresh-token-expiration: 1209600000

encryption:
  key: ${ENCRYPTION_KEY}

api:
  auction:
    base-url: ${API_AUCTION_BASE_URL:http://localhost:8083}

# Production에서는 Swagger 비활성화 (보안)
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false

logging:
  level:
    root: WARN
    com.fourtune: INFO

