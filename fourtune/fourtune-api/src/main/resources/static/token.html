<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>FCM í† í° ë°œê¸‰ê¸°</title>
</head>
<body>
<h1>ğŸ‘‡ F12(ê°œë°œìë„êµ¬) > Console íƒ­ì„ í™•ì¸í•˜ì„¸ìš”</h1>
<h2 id="status">í† í° ìš”ì²­ ì¤€ë¹„ ì¤‘...</h2>
<p>ì•„ë˜ ë°•ìŠ¤ì— í† í°ì´ ëœ¨ë©´ ë³µì‚¬í•˜ì„¸ìš”.</p>
<textarea id="tokenArea" rows="10" cols="80"></textarea>

<script type="module">
    // 1. ê°€ì ¸ì˜¤ì‹  ì„¤ì •ê°’ (ì œê°€ ì´ë¯¸ ë„£ì–´ë’€ìŠµë‹ˆë‹¤!)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCyGFtcYQrA4ebpoWZrcZzHrXlz2dZ6gK4",
        authDomain: "fourtune-9c05e.firebaseapp.com",
        projectId: "fourtune-9c05e",
        storageBucket: "fourtune-9c05e.firebasestorage.app",
        messagingSenderId: "927826319863",
        appId: "1:927826319863:web:1091feb08fff8fcf5036f2",
        measurementId: "G-YTZKL81JB3"
    };

    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);

    onMessage(messaging, (payload) => {
        console.log('ë©”ì‹œì§€ ë„ì°©!', payload);
        // ë¸Œë¼ìš°ì €ì— ê²½ê³ ì°½ ë„ìš°ê¸°
        alert(`[ì•Œë¦¼ ë„ì°©]\nì œëª©: ${payload.notification.title}\në‚´ìš©: ${payload.notification.body}`);
    });

    const VAPID_KEY = "BCREan7uaddsBuULpMcEkGUNIBmvxB1QInjJcX54s0hqvNnm-LufnIUO2VGoKKz7ssh3ysgNZ8ih9XR1PcBlsW0";

    async function getMyToken() {
        try {
            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                document.getElementById('status').innerText = "ê¶Œí•œ í—ˆìš©ë¨. í† í° ê°€ì ¸ì˜¤ëŠ” ì¤‘...";

                const currentToken = await getToken(messaging, { vapidKey: VAPID_KEY });

                if (currentToken) {
                    console.log('--- ë‚´ í† í° ---');
                    console.log(currentToken);
                    document.getElementById('tokenArea').value = currentToken;
                    document.getElementById('status').innerText = "âœ… ì„±ê³µ! ì•„ë˜ í† í°ì„ ë³µì‚¬í•˜ì„¸ìš”.";
                } else {
                    document.getElementById('status').innerText = "í† í° ì—†ìŒ. ê¶Œí•œ ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                }
            } else {
                document.getElementById('status').innerText = "âŒ ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.";
            }
        } catch (err) {
            console.log('ì—ëŸ¬:', err);
            document.getElementById('status').innerText = "âŒ ì—ëŸ¬ ë°œìƒ (VAPID Keyë¥¼ í™•ì¸í•˜ì„¸ìš”)";
        }
    }

    getMyToken();
</script>
</body>
</html>
