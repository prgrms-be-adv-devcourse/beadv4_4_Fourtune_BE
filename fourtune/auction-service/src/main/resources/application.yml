# 경매 서비스 메인 설정 (로직/운영용). 테스트는 application-test.yml 및 테스트 코드에서.
# Postgres 사용 시: 로컬에 auction DB 없으면 생성 필요 → psql -U postgres -c "CREATE DATABASE auction;"
# 또는 프로파일 없이 기동만 확인하려면: --spring.profiles.active=local (H2 메모리 DB)
spring:
  application:
    name: auction-service
  config:
    import: "classpath:application-common.yml"
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: update
    open-in-view: false
    properties:
      hibernate:
        jdbc:
          time_zone: Asia/Seoul
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/auction}
    username: ${DB_USERNAME:fourtune_user}
    password: ${DB_PASSWORD:fourtune}
    driver-class-name: org.postgresql.Driver
  # redis, kafka bootstrap-servers, jwt 기본값 → application-common.yml
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
  kafka:
    # bootstrap-servers from application-common.yml
    consumer:
      group-id: auction-consumer-group
  cloud:
    aws:
      credentials:
        access-key: ${AWS_ACCESS_KEY:minioadmin}
        secret-key: ${AWS_SECRET_KEY:minioadmin}
      region:
        static: ${AWS_REGION:ap-northeast-2}
      s3:
        bucket: ${AWS_S3_BUCKET:auction-local}
        path-prefix: ${S3_PATH_PREFIX:local}
        # MinIO 등 커스텀 엔드포인트 (로컬: http://minio:9000, 운영: 미설정 → AWS S3 기본 엔드포인트 사용)
        endpoint: ${S3_ENDPOINT_URL:}
        # 브라우저에서 접근할 공개 URL (로컬: http://localhost:9000, 운영: https://버킷명.s3.리전.amazonaws.com)
        public-url: ${S3_PUBLIC_URL:}

server:
  port: ${SERVER_PORT:8083}

# common OAuth2SuccessHandler (OAuth 로그인은 API 서버에서 처리, 경매 서비스는 리다이렉트 URI만 필요)
app:
  oauth2:
    redirect-uri: ${OAUTH_FRONTEND_URI:http://localhost:3000/login-success}
  view-count:
    use-redis: ${VIEW_COUNT_USE_REDIS:true}
    key-prefix: "auction:view:"
    sync-interval-ms: 60000  # 1분마다 Redis → DB 동기화

# common FirebaseConfig 비활성 (경매 서비스는 FCM 미사용)
firebase:
  enabled: false

# JWT: secret 등 기본값은 application-common.yml, 경매만 만료 시간 override
jwt:
  access-token-expiration: ${JWT_ACCESS_TOKEN_EXPIRATION:1800000}
  refresh-token-expiration: ${JWT_REFRESH_TOKEN_EXPIRATION:1209600000}

api:
  user:
    base-url: ${API_USER_BASE_URL:http://localhost:8080}

auction:
  bid-unit: 1000 # 입찰 단위 (원)
  auto-extend-minutes: 3 # 자동 연장 시간
  auto-extend-threshold-minutes: 5 # 연장 발동 시간
  payment-deadline-days: 1 # 결제 기한 (낙찰 기준)
  seller-shipping-deadline-days: 7 # 발송 기한
  settlement-fee-rate: 0.1 # 정산 수수료 (10%)

order:
  buy-now-pending-timeout-minutes: ${ORDER_BUYNOW_PENDING_TIMEOUT_MINUTES:10} # 즉시구매 결제 유예 (분)
  bid-pending-timeout-hours: ${ORDER_BID_PENDING_TIMEOUT_HOURS:24} # 낙찰 결제 유예 (시간)

settlement:
  scheduler:
    collect-cron: ${SETTLEMENT_SCHEDULER_COLLECT_CRON:0 */5 * * * *} # (시연용) 5분마다
    complete-cron: ${SETTLEMENT_SCHEDULER_COMPLETE_CRON:0 */5 * * * *} # (시연용) 5분마다
  policy:
    waiting-days: ${SETTLEMENT_POLICY_WAITING_DAYS:0} # 구매 확정 후 정산 대기 일수

search:
  page-size: 20 # 검색 결과 페이지 크기
  max-from: 10000 # Deep paging 최대 from 값
  max-keyword-length: 100 # 검색 키워드 최대 길이

springdoc:
  api-docs:
    path: /v3/api-docs
    enabled: true
  swagger-ui:
    enabled: false          # 각 서비스 자체 UI는 비활성 (aggregation용 엔드포인트만 노출)
  paths-to-exclude:
    - /actuator/**
    - /error

feature:
  kafka:
    enabled: true
  kafka.auction-events:
    enabled: true

# Outbox (common OutboxPublisher 사용, feature.kafka.enabled=true 시 활성)
outbox:
  publisher:
    batch-size: 100
    max-retry-count: 3
    poll-interval-ms: 1000

# Actuator (health, Prometheus 메트릭)
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  metrics:
    export:
      prometheus:
        enabled: true

logging:
  level:
    root: INFO
    com.fourtune: DEBUG
